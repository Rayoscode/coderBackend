(()=>{var e={863:e=>{e.exports={options:{client:"mysql",connection:{host:"localhost",user:"root",password:"",database:"ecommerce"}}}},851:e=>{e.exports={options:{client:"sqlite3",connection:{filename:"./DB/ecommerce.sqlite"}}}},350:(e,t,s)=>{e.exports=class{constructor(e,t){this.knex=s(514)(t),this.tableName=e}insertMessage=async(e,t)=>{try{await this.knex(this.tableName).insert({message:e,name:t})}catch(e){console.log(e)}};deleteMessage=()=>{};upgradeMessage=()=>{};selectMessage=async()=>{try{return await this.knex.from(this.tableName).select("*")}catch(e){console.log(e)}};createTable=async()=>{try{await this.knex.schema.hasTable(this.tableName)&&await this.knex.schema.dropTable(this.tableName),await this.knex.schema.createTable(this.tableName,(e=>{e.increments("id"),e.string("name",30),e.string("message",100)}))}catch(e){console.log(e)}}}},177:(e,t,s)=>{e.exports=class{constructor(e,t){this.knex=s(514)(t),this.tableName=e}insertProduct=async(e,t,s)=>{try{await this.knex(this.tableName).insert({title:e,price:t,thumbnail:s})}catch(e){console.log(e)}};deleteMessage=()=>{};upgradeMessage=()=>{};selectProductos=async()=>{try{return await this.knex.from(this.tableName).select("*")}catch(e){console.log(e)}};createTable=async()=>{try{await this.knex.schema.hasTable(this.tableName)&&await this.knex.schema.dropTable(this.tableName),await this.knex.schema.createTable(this.tableName,(e=>{e.increments("id"),e.string("title",30),e.string("thumbnail",300),e.float("price")}))}catch(e){console.log(e)}}}},348:(e,t,s)=>{const a=s(860),{options:o}=s(863),{Router:n}=a,r=s(177),c=n(),i=new r("PRODUCTOS",o);i.createTable(),c.get("/productos",(async(e,t)=>{const s=await i.selectProductos();t.json(s)})),c.get("/productos/:id",((e,t)=>{const{id:s}=e.params})),c.post("/productos",(async(e,t)=>{try{i.insertProduct(e.body),t.sendStatus(200)}catch(e){t.status(500).send(e)}})),c.put("/productos/:id",((e,t)=>{const{id:s}=e.params;ContenedorData.getById(s).then((a=>{if(null==a)t.send({error:"producto no encontrado"});else{const a={...e.body,id:s};ContenedorData.upgradeByID(a),t.json(a)}}))})),c.delete("/productos/:id",((e,t)=>{const{id:s}=e.params;ContenedorData.getById(s).then((e=>{null==e?t.send({error:"producto no encontrado"}):(ContenedorData.deleteByID(s),t.json({result:"ok"}))}))})),e.exports=c},860:e=>{"use strict";e.exports=require("express")},514:e=>{"use strict";e.exports=require("knex")},952:e=>{"use strict";e.exports=require("socket.io")},685:e=>{"use strict";e.exports=require("http")}},t={};function s(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,s),n.exports}(()=>{const e=s(860),{Server:t}=s(685),{Server:a}=s(952),o=s(348),n=s(350);let{options:r}=s(851);const c=s(177),i=e(),l=new t(i),d=new a(l),u=new n("MENSAJES",r);u.createTable();const h=new c("PRODUCTOS",s(863).options);l.listen(8080,(()=>{console.log("Se inicio el server")})),i.use("/api",o),i.use(e.static("public")),i.use(e.static("pages")),i.get("/",((e,t)=>{t.sendFile("/index.html")})),i.get("/mensajes",(async(e,t)=>{const s=await u.selectMessage();t.json(s)})),d.on("connection",(async e=>{e.on("saveMessage",(e=>{d.sockets.emit("currentChat",e),u.insertMessage(e.mensaje,e.nombre)})),e.on("nuevoProducto",(async e=>{h.insertProduct(e),d.sockets.emit("actualizarProductos",e)}))}))})()})();